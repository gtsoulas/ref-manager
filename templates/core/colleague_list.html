{% extends 'base.html' %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row">
        <!-- Sidebar for filters -->
        <div class="col-md-2">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h6 class="mb-0">Filter by Category</h6>
                </div>
                <div class="list-group list-group-flush">
                    <a href="?category=all" 
                       class="list-group-item list-group-item-action {% if category_filter == 'all' %}active{% endif %}">
                        All Colleagues
                        <span class="badge bg-secondary float-end">{{ category_counts.all }}</span>
                    </a>
                    <a href="?category=employee" 
                       class="list-group-item list-group-item-action {% if category_filter == 'employee' %}active{% endif %}">
                        Current Employees
                        <span class="badge bg-success float-end">{{ category_counts.employee }}</span>
                    </a>
                    <a href="?category=former" 
                       class="list-group-item list-group-item-action {% if category_filter == 'former' %}active{% endif %}">
                        Former Employees
                        <span class="badge bg-secondary float-end">{{ category_counts.former }}</span>
                    </a>
                    <a href="?category=coauthor" 
                       class="list-group-item list-group-item-action {% if category_filter == 'coauthor' %}active{% endif %}">
                        Co-authors (External)
                        <span class="badge bg-info float-end">{{ category_counts.coauthor }}</span>
                    </a>
                    <a href="?category=non_independent" 
                       class="list-group-item list-group-item-action {% if category_filter == 'non_independent' %}active{% endif %}">
                        Non Independent
                        <span class="badge bg-warning float-end">{{ category_counts.non_independent }}</span>
                    </a>
                </div>
            </div>
            
            <div class="card mt-3">
                <div class="card-header">
                    <h6 class="mb-0">Tools</h6>
                </div>
                <div class="card-body">
                    <a href="{% url 'find_duplicate_colleagues' %}" class="btn btn-warning btn-sm w-100 mb-2">
                        <i class="fas fa-search"></i> Find Duplicates
                    </a>
                    <a href="{% url 'colleague_create' %}" class="btn btn-primary btn-sm w-100">
                        <i class="fas fa-plus"></i> Add Colleague
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Main content -->
        <div class="col-md-10">
            <h2>
                <i class="fas fa-users"></i> Colleagues
                {% if category_filter != 'all' %}
                    <small class="text-muted">
                        ({{ colleagues|length }} 
                        {% if category_filter == 'employee' %}Current Employees
                        {% elif category_filter == 'former' %}Former Employees
                        {% elif category_filter == 'coauthor' %}Co-authors
                        {% elif category_filter == 'non_independent' %}Non Independent Researchers
                        {% endif %})
                    </small>
                {% else %}
                    <small class="text-muted">({{ colleagues|length }} total)</small>
                {% endif %}
            </h2>
            
            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Staff ID</th>
                                    <th>Title</th>
                                    <th>Category</th>
                                    <th>Employment Status</th>
                                    <th>FTE</th>
                                    <th>Outputs</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for colleague in colleagues %}
                                    <tr>
                                        <td>
                                            <strong>
                                                {% if colleague.user %}
                                                    {{ colleague.user.get_full_name }}
                                                {% else %}
                                                    {{ colleague.staff_id }}
                                                {% endif %}
                                            </strong>
                                            {% if colleague.user %}
                                                <br>
                                                <small class="text-muted">{{ colleague.user.email }}</small>
                                            {% endif %}
                                        </td>
                                        <td>{{ colleague.staff_id }}</td>
                                        <td>{{ colleague.title }}</td>
                                        <td>
                                            <form method="post" action="{% url 'update_colleague_category' colleague.id %}" class="d-inline">
                                                {% csrf_token %}
                                                <select name="category" class="form-select form-select-sm" 
                                                        onchange="if(confirm('Change category for {{ colleague.user.get_full_name|default:colleague.staff_id }}?')) { this.form.submit(); }" 
                                                        style="width: auto; min-width: 180px;">
                                                    <option value="employee" {% if colleague.colleague_category == 'employee' %}selected{% endif %}>
                                                        Current Employee
                                                    </option>
                                                    <option value="former" {% if colleague.colleague_category == 'former' %}selected{% endif %}>
                                                        Former Employee
                                                    </option>
                                                    <option value="coauthor" {% if colleague.colleague_category == 'coauthor' %}selected{% endif %}>
                                                        Co-author (External)
                                                    </option>
                                                    <option value="non_independent" {% if colleague.colleague_category == 'non_independent' %}selected{% endif %}>
                                                        Non Independent
                                                    </option>
                                                </select>
                                            </form>
                                        </td>
                                        <td>
                                            <span class="badge {% if colleague.employment_status == 'current' %}bg-success{% else %}bg-secondary{% endif %}">
                                                {{ colleague.get_employment_status_display }}
                                            </span>
                                        </td>
                                        <td>{{ colleague.fte }}</td>
                                        <td>
                                            <span class="badge bg-primary">
                                                {{ colleague.output_count }}
                                            </span>
                                        </td>
                                        <td>
                                            <div class="btn-group btn-group-sm" role="group">
                                                <a href="{% url 'colleague_detail' colleague.id %}" 
                                                   class="btn btn-info" 
                                                   title="View">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                                <a href="{% url 'colleague_update' colleague.id %}" 
                                                   class="btn btn-warning" 
                                                   title="Edit">
                                                    <i class="fas fa-edit"></i>
                                                </a>
                                            </div>
                                        </td>
                                    </tr>
                                {% empty %}
                                    <tr>
                                        <td colspan="8" class="text-center text-muted py-4">
                                            <i class="fas fa-users-slash fa-3x mb-3"></i>
                                            <p>No colleagues found in this category.</p>
                                            {% if category_filter != 'all' %}
                                                <a href="?category=all" class="btn btn-sm btn-primary">
                                                    Show All Colleagues
                                                </a>
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
